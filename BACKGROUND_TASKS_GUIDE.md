# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ Background Tasks

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ BackgroundTaskService

### ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

1. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ expirationHandler** - —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç OperationQueue –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ—Ç–º–µ–Ω—ã –æ–ø–µ—Ä–∞—Ü–∏–π
2. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è** - –ø–ª–∞–Ω–∏—Ä—É–µ—Ç —Å–ª–µ–¥—É—é—â—É—é –∑–∞–¥–∞—á—É –î–û –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π
3. **–ë–æ–ª–µ–µ —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Ä–µ–º—è –∏–∑ AutoSendService –≤–º–µ—Å—Ç–æ —Ö–∞—Ä–¥–∫–æ–¥–∞
4. **–õ—É—á—à–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ Background App Refresh** - –¥–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π
5. **–î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏** - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ pending –∑–∞–¥–∞—á–∞—Ö

## üì± –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç Background Tasks –≤ iOS

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
- **BGAppRefreshTask** - –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **BGProcessingTask** - –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª** - 15 –º–∏–Ω—É—Ç –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏
- **–ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–π –≤—Ä–µ–º–µ–Ω–∏** - iOS —Ä–µ—à–∞–µ—Ç, –∫–æ–≥–¥–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–¥–∞—á—É
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è** - –æ–±—ã—á–Ω–æ 30 —Å–µ–∫—É–Ω–¥

### –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏:
1. **–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∑–∞–¥–∞—á—É —Å—Ä–∞–∑—É** - –≤ –Ω–∞—á–∞–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—É—â–µ–π
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ OperationQueue** - –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
3. **–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ expirationHandler** - –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ—Ç–º–µ–Ω—ã
4. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ Background App Refresh** - –ø–µ—Ä–µ–¥ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
5. **–õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** - –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Background Tasks

### 1. –ù–∞ —Ä–µ–∞–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ:
```bash
# –í –∫–æ–Ω—Å–æ–ª–∏ Xcode (Debug > Console)
e -l objc -- (void)[[BGTaskScheduler sharedScheduler] _simulateLaunchForTaskWithIdentifier:@"com.katapios.LazyBones.sendReport"]
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:
```swift
// –í –∫–æ–¥–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
let refreshStatus = UIApplication.shared.backgroundRefreshStatus
print("Background refresh status: \(refreshStatus)")
```

### 3. –û—Ç–ª–∞–¥–∫–∞ –≤ DEBUG —Ä–µ–∂–∏–º–µ:
```swift
// –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ background task
#if DEBUG
backgroundTaskService.testBackgroundTask()
#endif
```

### 4. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ pending –∑–∞–¥–∞—á–∞—Ö:
```swift
let info = await backgroundTaskService.getPendingTasksInfo()
print(info)
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. –í–∫–ª—é—á–∏—Ç–µ Background App Refresh:
- Settings > General > Background App Refresh
- –í–∫–ª—é—á–∏—Ç–µ –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Info.plist:
```xml
<key>BGTaskSchedulerPermittedIdentifiers</key>
<array>
    <string>com.katapios.LazyBones.sendReport</string>
</array>
<key>UIBackgroundModes</key>
<array>
    <string>fetch</string>
    <string>processing</string>
</array>
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ entitlements:
```xml
<key>com.apple.security.application-groups</key>
<array>
    <string>group.com.H2GFBK2X44.loopkit.LoopGroup</string>
</array>
```

## üö® –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: –ó–∞–¥–∞—á–∏ –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Background App Refresh –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –≤ —Ä–µ–∂–∏–º–µ "Low Power Mode"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ identifier –µ—Å—Ç—å –≤ Info.plist

### –ü—Ä–æ–±–ª–µ–º–∞: –ó–∞–¥–∞—á–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ
**–†–µ—à–µ–Ω–∏–µ:**
- –£–≤–µ–ª–∏—á—å—Ç–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–æ 15+ –º–∏–Ω—É—Ç
- –ù–µ –ø–ª–∞–Ω–∏—Ä—É–π—Ç–µ –∑–∞–¥–∞—á–∏ —á–∞—â–µ, —á–µ–º —Ä–∞–∑ –≤ –¥–µ–Ω—å

### –ü—Ä–æ–±–ª–µ–º–∞: –ó–∞–¥–∞—á–∏ –Ω–µ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
**–†–µ—à–µ–Ω–∏–µ:**
- –í—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–π—Ç–µ `setTaskCompleted(success:)`
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ OperationQueue –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ expirationHandler

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
```
üîÑ Background task triggered: com.katapios.LazyBones.sendReport
‚úÖ Background task scheduled for: 2024-01-15 22:01:00
‚úÖ Background task completed successfully
```

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö/–Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–¥–∞—á
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á
- –ß–∞—Å—Ç–æ—Ç–∞ –∑–∞–ø—É—Å–∫–∞ –∑–∞–¥–∞—á
- –°—Ç–∞—Ç—É—Å Background App Refresh

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª Background Task

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** - –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ background –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
3. **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** - iOS –∑–∞–ø—É—Å–∫–∞–µ—Ç –∑–∞–¥–∞—á—É –≤ –ø–æ–¥—Ö–æ–¥—è—â–µ–µ –≤—Ä–µ–º—è
4. **–û–±—Ä–∞–±–æ—Ç–∫–∞** - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–≤—Ç–æ–æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç—á–µ—Ç–æ–≤
5. **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–π** - –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–∏
6. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ** - –≤—ã–∑–æ–≤ setTaskCompleted

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ù–µ –ø–æ–ª–∞–≥–∞–π—Ç–µ—Å—å –Ω–∞ —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è** - iOS –º–æ–∂–µ—Ç –∑–∞–¥–µ—Ä–∂–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã
3. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö** - —Å–∏–º—É–ª—è—Ç–æ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç BG tasks
4. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏** - –≤—Å–µ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–π—Ç–µ fallback —Å—Ü–µ–Ω–∞—Ä–∏–∏
5. **–ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è** - –±—ã—Å—Ç—Ä—ã–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–∞—â–µ

